#!/usr/bin/env bash
set -euo pipefail

# Check for tracked key/cert files
bad=$(git ls-files | rg -i '\.(p8|pem|p12)$' || true)
if [[ -n "$bad" ]]; then
  echo "ERROR: key/cert files tracked:"
  echo "$bad"
  exit 1
fi

# Check for tracked master key
if git ls-files | rg -q '^config/master\.key$'; then
  echo "ERROR: config/master.key is tracked"
  exit 1
fi

# Check for tracked credentials key
if git ls-files | rg -q 'config/credentials.*\.key$'; then
  echo "ERROR: credentials key files are tracked"
  exit 1
fi

# Check for tracked .env files
if git ls-files | rg -q '(^|/)\.env(\.|$)'; then
  echo "ERROR: .env files are tracked"
  exit 1
fi

echo "Secret check passed"

